<!doctype html>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-J1STH8DQL9"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-J1STH8DQL9");
    </script>
    <meta charset="UTF-8" />
    <title>oh kay blanket</title>
    <meta name="theme-color" content="#e6e6ce" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:url" content="https://ohkayblanket.com" />
    <meta property="og:title" content="Kayla Plunkett Portfolio" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="UI/UX Development" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />
    <link type="text/css" rel="stylesheet" href="css/fontawesome/css/all.css" />
    <link rel="icon" href="img/logo.png" />
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="heading">
        <img class="logo" src="img/headshot-2025-10.jpg" />
        <div class="about">
          <h1 class="name">Hi, I'm Kay</h1>
          <!-- <h4 id="location">dallas, texas</h4> -->
          <p>
            I reside in Dallas, Texas. I find joy in crafting tools out of thin
            air, finding stories in the seemingly chaotic, and pssping cats.
            Here are some things I have made.
          </p>
          <div class="icons">
            <a href="mailto:kayla.lee.plunkett@gmail.com">
              <i class="fas fa-envelope"></i>
            </a>
            <a href="https://github.com/oh-kay-blanket">
              <i class="fab fa-github"></i>
            </a>
            <a href="https://www.linkedin.com/in/kaylaleeplunkett/">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
        </div>
      </div>

      <div class="projects">
        <div class="projects__heading">
          <ul id="type-filter">
            <li data-filter="*" class="active">all</li>
            <li data-filter=".code">code</li>
            <li data-filter=".viz">data visualization</li>
            <!-- <li data-filter=".ui">design</li> -->
            <li data-filter=".art">art</li>
          </ul>
        </div>

        <div class="links-container">
          <!-- Projects will be dynamically loaded from CSV -->
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  // Global Isotope instance
  let iso;

  // CSV Parser Functions
  function parseCSVLine(line) {
    const values = [];
    let current = "";
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const char = line[i];

      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === "," && !inQuotes) {
        values.push(current.trim());
        current = "";
      } else {
        current += char;
      }
    }
    values.push(current.trim());

    return values;
  }

  function parseCSV(csv) {
    const lines = csv.trim().split("\n");
    // Detect separator (comma or tab)
    const separator = lines[0].includes("\t") ? "\t" : ",";
    const headers = lines[0].split(separator);

    return lines.slice(1).map((line) => {
      const values = separator === "\t" ? line.split("\t") : parseCSVLine(line);
      const project = {};
      headers.forEach((header, index) => {
        project[header] = values[index] || "";
      });
      return project;
    });
  }

  // Render projects from CSV data
  function renderProjects(projects) {
    const container = document.querySelector(".links-container");

    projects.forEach((project) => {
      const linkBlock = document.createElement("a");
      linkBlock.href = project.url;
      linkBlock.className = `link-block ${project.categories}`;

      linkBlock.innerHTML = `
        <div class="img-wrapper">
          <img class="img-placeholder" src="./img/projects/tall/placeholder.jpg" alt="" />
          <img
            class="img-full"
            src="./img/projects/tall/${project.image}"
            alt="${project.title} placeholder image"
            loading="lazy"
          />
        </div>
        <div class="link-block__header">
          <h4>${project.title}</h4>
          <p>${project.description}</p>
          <p class="tools">${project.tools}</p>
        </div>
      `;

      container.appendChild(linkBlock);
    });

    // Initialize Isotope after rendering
    initIsotope();
  }

  // Initialize Isotope
  function initIsotope() {
    const grid = document.querySelector(".links-container");
    iso = new Isotope(grid, {
      itemSelector: ".link-block",
      layoutMode: "fitRows",
    });
  }

  // Load projects from CSV
  async function loadProjects() {
    try {
      const response = await fetch("./projects.csv");
      const csvText = await response.text();
      const projects = parseCSV(csvText);
      renderProjects(projects);
      initImageLoading();
    } catch (error) {
      console.error("Error loading projects:", error);
    }
  }

  // Filter buttons
  const filterButtons = document.querySelectorAll("#type-filter li");

  filterButtons.forEach(function (btn) {
    btn.addEventListener("click", function () {
      filterButtons.forEach(function (filBun) {
        filBun.classList.remove("active");
      });
      btn.classList.add("active");
      iso.arrange({ filter: btn.dataset.filter });
      // Re-check images after filter
      setTimeout(initImageLoading, 100);
    });
  });

  // Image blur-up loading
  function initImageLoading() {
    const imageWrappers = document.querySelectorAll(".img-wrapper");

    imageWrappers.forEach((wrapper) => {
      const fullImage = wrapper.querySelector(".img-full");

      if (!fullImage) return;

      // Check if already loaded (cached)
      if (fullImage.complete && fullImage.naturalHeight !== 0) {
        fullImage.classList.add("loaded");
        if (iso) iso.layout();
        return;
      }

      // Preload image
      fullImage.addEventListener("load", function () {
        fullImage.classList.add("loaded");
        // Recalculate Isotope layout after image loads
        if (iso) iso.layout();
      });
    });
  }

  // Load projects when page loads
  document.addEventListener("DOMContentLoaded", function () {
    loadProjects();
  });
</script>
